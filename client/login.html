<template name="signin_overlay">
  {{#if signingIn}}
    <div class="signin-overlay" style="width: {{windowWidth}}px; height: {{windowHeight}}px;">

      <div class="signin-modal">
        <button class="close">✕</button>
        {{#if onSignupStage}}
          <div class="title {{#if explanation}}has-explanation{{/if}}"><img src="{{c.url 'static/foldtitle.svg'}}"></div>
          {{#if explanation}}
            <div class="explanation">{{explanation}}</div>
          {{else}}
            <div class="slogan">Create, Remix, Discover.</div>
          {{/if}}
          <ol class="user-menu">
            <li>
              <button class="twitter-signin"><span>Sign in with Twitter</span>{{> login_bird}}</button>
            </li>
            <li>
              <button class="email-signup"><span>Sign up with email</span></button>
            </li>
          </ol>
          <div class="already-have">Already have an account? <button class="go-to-login text">Sign in.</button></div>
        {{/if}}

        {{#if onLoginStage}}
          {{> login_form}}
        {{/if}}

        {{#if onInfoStage}}
          {{> info_form}}
        {{/if}}

        {{#if onPasswordStage}}
          {{> password_form}}
        {{/if}}

        {{#if onOnboardingStage}}
          {{> onboarding_screen}}
        {{/if}}

      </div>

    </div>
  {{/if}}
</template>

<template name="info_form">
  {{#unless twitterUser}}
    <button class="back back-to-signup text">Go back</button>
  {{/unless}}
  <form id="info-form" disabled="{{disableSignup}}" action="action">
    <!-- Email -->
    <input name="email"
           type="email"
           placeholder="Email address"
           dir="auto"
           value="{{initialEmail}}"
           autofocus="autofocus"
           class="signup-email {{#if emailError}}error{{/if}}"
           required
        >
    <span class="status">{{#if emailError}}{{> login_x}}{{else}}{{#if emailComplete}}{{>login_check}}{{/if}}{{/if}}</span>
    {{#if emailError}}<span class="error">{{emailError}}</span>{{/if}}


    <!-- Username -->
    <input name="username"
           type="text"
           placeholder="Username"
           dir="auto"
           value="{{initialUsername}}"
           class="signup-username {{#if usernameError}}error{{/if}}"
           required
        >
    <span class="status">{{#if usernameError}}{{> login_x}}{{else}}{{#if usernameComplete}}{{>login_check}}{{/if}}{{/if}}</span>
    {{#if usernameError}}<span class="error">{{usernameError}}</span>{{/if}}

    <!-- Name -->
    <input name="name"
           type="text"
           placeholder="Full name"
           dir="auto"
           value="{{initialName}}"
           class="signup-name {{#if nameError}}error{{/if}}"
           required
    >
    <span class="status">{{#if nameError}}{{> login_x}}{{else}}{{#if nameComplete}}{{>login_check}}{{/if}}{{/if}}</span>
    {{#if nameError}}<span class="error">{{nameError}}</span>{{/if}}



    {{#if signupError}}<div class="error">{{signupError}}</div>{{/if}}


    {{#if twitterUser}}
      <p class="accept">By creating an account, I accept FOLD’s {{#linkTo route="terms" target='_blank' class='green'}}Terms of Service{{/linkTo}} and {{#linkTo route="privacy" target='_blank' class='green'}}Privacy Policy{{/linkTo}}.</p>
      <button type="submit" disabled="{{disableSignup}}" class="signup-button">Sign up</button>
    {{else}}
      <button type="submit" disabled="{{disableSignup}}" class="signup-button">Next</button>
    {{/if}}

    {{#if submitting}}
      {{> loading_icon}}
    {{/if}}
  </form>
</template>


<template name="password_form">
  <button class="back back-to-info text">Go back</button>
  <form id="password-form" disabled="{{disableSignup}}" action="action">
    <!-- Password -->
    <input name="password"
           type="password"
           placeholder="Password"
           dir="auto"
           autofocus="autofocus"
           class="signup-password {{#if passwordError}}error{{/if}}"
           required
        >
    <span class="status">{{#if passwordError}}{{> login_x}}{{else}}{{#if passwordComplete}}{{>login_check}}{{/if}}{{/if}}</span>
    {{#if passwordError}}<span class="error">{{passwordError}}</span>{{/if}}

    <input name="password2"
           type="password"
           placeholder="Type that password again!"
           dir="auto"
           class="signup-password2 {{#if password2Error}}error{{/if}}"
           required
        >
    <span class="status">{{#if password2Error}}{{> login_x}}{{else}}{{#if password2Complete}}{{>login_check}}{{/if}}{{/if}}</span>
    {{#if password2Error}}<span class="error">{{password2Error}}</span>{{/if}}


    {{#if signupError}}<div class="error">{{signupError}}</div>{{/if}}

    <p class="accept">By creating an account, I accept FOLD’s {{#linkTo route="terms" target='_blank' class='green'}}Terms of Service{{/linkTo}} and {{#linkTo route="privacy" target='_blank' class='green'}}Privacy Policy{{/linkTo}}.</p>
    <button type="submit" disabled="{{disableSignup}}" class="signup-button">Sign up</button>
    {{#if submitting}}
      {{> loading_icon}}
    {{/if}}
  </form>
</template>


<template name="onboarding_screen">
  {{#with currentUser}}
    <div class="all-set">You're all set!</div>
    <div class="author-image">
      <img class="profile-picture" src="{{profileImage this}}"/>
    </div>

    <div class="author-name-username">
      <div class="author-name">Welcome <a href="/profile/{{username}}">{{firstName user}}</a></div>
      <div class="publish-date">{{username}}</div>
    </div>
    <div>
      To edit your photo or display name, visit your <a href="/profile/{{username}}">profile</a>.
    </div>
    <button class="finish">Thanks</button>
  {{/with}}
</template>



<template name="login_form">
  <button class="back back-to-signup text">Go back</button>
  <form id="login-form" action="action">
    <label for="username"> Username or Email </label>
    <input name="username" type="text" placeholder="username or email" autofocus="autofocus" required>
    <label for="password"> Password </label>
    <input name="password" type="password" placeholder="password" required>

    {{#if loginError}}
      <div class="error">
        {{loginError}}
      </div>
    {{/if}}

    <button type="submit" class="login-button">Log in</button>
    {{#if loggingIn}}
      {{> loading_icon}}
    {{/if}}
    <a href="/recover-password" class="recover-password-link">Lost password?</a>
  </form>
  <div class="vertical-divider">OR</div>
  <button class="twitter-signin">Sign in with Twitter</button>
</template>
