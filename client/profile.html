<template name="profile">
  {{> top_banner border="remix-border"}}
  <div class="profile-section">
    <section>
      <div class="user-profile">
        {{> user_profile}}
      </div>
    </section>
  </div>
    <div class="stories profile">
      <section>
        <div class="story-container">
          {{> user_stories}}
        </div>
        <div class="horizontal-line"></div>
        <div class="story-container">
          {{> user_favorite_stories}}
        </div>
      </section>
    </div>

  {{> footer}}
</template>


<template name="user_profile">
  {{#if editting}}
    <div class="user-info-form">
      {{#autoForm collection=UsersCollection doc=currentUser id="updateProfileForm" type="update" validation="keyup"}}
        {{> afQuickField name='profile.name'}}
        {{> afQuickField name='profile.bio' class="bio-form"}}
        <button type="submit" class="save-profile-button">Save</button>
      {{/autoForm}}
    </div>
  {{else}}
    {{#if ownProfile}}
      <button class="edit-profile">Edit</button>
    {{/if}}
    <div class="profile-picture">
      {{#if profileImage}} 
         <img class="profile-picture-large" src="{{profileImage}}"/>
      {{/if}}
    </div>
    <div class="name">{{name}}</div>
    <div class="bio">{{bio}}</div>
  {{/if}}
</template>

<template name="user_stories">
  <h1>Latest stories</h1>
  {{#each writtenStories}}
    {{#with draftStory}}
      {{#if published}}
        {{#linkTo route="read" data=this}}
          <div class="profile story" data-story-id="{{_id}}">
            {{> _story_preview_content}}
          </div>
        {{/linkTo}}
      {{/if}}
    {{/with}}
  {{/each}}
</template>

<template name="user_favorite_stories">
  <h1>Favorites</h1>
  {{#each favoriteStories}}
    {{#linkTo route="read" data=this}}
      <div class="profile story" data-story-id="{{_id}}">
        {{> _story_preview_content}}
      </div>
    {{/linkTo}}
  {{/each}}
</template>


<template name="my_story_profile">
  {{> top_banner border="remix-border"}}
  <div class="stories">
    <section>
      <div class="story-container">
        {{> my_stories}}
      </div>
    </section>
  </div>
</template>

<template name="my_stories">
  <h1>My Drafts</h1>
  {{#each writtenStories}}
    {{#linkTo route="edit" data=this}}
      <div class="story" data-story-id="{{_id}}">
        {{#with draftStory}}
          {{> _story_preview_content}}
        {{/with}}
        <!--<div class="dates">-->
          <!--<p>Last Edited: {{lastEditDate}}</p>-->
          <!--<p>-->
            <!--{{#if published}}-->
              <!--Published On: {{lastPublishDate}}-->
              <!--{{else}}-->
              <!--Unpublished-->
            <!--{{/if}}-->
          <!--</p>-->
        <!--</div>-->
      </div>
    {{/linkTo}}
  {{/each}}
</template>
