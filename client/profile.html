<template name="profile">
  {{> top_banner}}
  <div class="profile-section">
    <section>
      <div class="user-profile">
        {{> user_profile}}
      </div>
    </section>
  </div>
    <div class="stories profile">
      <section>
        <div class="story-container profile">
          {{> user_stories}}
        </div>
        <div class="horizontal-line"></div>
        <div class="story-container profile">
          {{> user_favorite_stories}}
        </div>
      </section>
    </div>

  {{> contact_footer}}
</template>


<template name="user_profile">
  {{#if editing}}
    <div class="user-info-form">
      {{#autoForm collection=UsersCollection doc=currentUser id="updateProfileForm" type="method-update" meteormethod="updateProfile" validation="keyup"}}
      <button type="submit" class="save-profile-button">Save</button>
      
       <div class="picture">
        {{#if editingPicture}}
          <input type="file" accept="image/*" class="overlay" data-label="Upload Image">
        {{/if}}
        {{#if uploadPreview}} 
          <img class="profile-picture-large" src="{{uploadPreview}}">
        {{else}}
          {{#if profileImage user}} 
           <img class="profile-picture-large" src="{{profileImage user 'large'}}"/>
          {{else}}
            <img class="profile-picture-large" src="{{c.url 'static/placeholder_image.png'}}"/>
          {{/if}}
        {{/if}}
     </div>
      <div class="user-info">
        {{> afQuickField name='profile.name'}}
        {{> afQuickField name='profile.bio' class="bio-form"}}
      </div>
    {{/autoForm}}
  </div>
  {{else}}
    {{#if ownProfile}}
      <button class="edit-profile">Edit</button>
    {{/if}}
    <div class="picture">
      {{#if profileImage user}} 
         <img class="profile-picture-large" src="{{profileImage user 'large'}}"/>
      {{else}}
        <img class="profile-picture-large" src="{{c.url 'static/placeholder_image.png'}}"/>
      {{/if}}
    </div>
    <div class="name">{{name}}</div>
    <div class="bio">{{bio}}</div>
  {{/if}}
</template>

<template name="user_stories">
  <h1>Latest stories</h1>
  {{#if hasPublished}}
    {{#if showAllPublishedButton}}
      <button class="toggle-published">
        See {{#if seeAllPublished}}fewer{{else}}all{{/if}} stories
      </button>
    {{/if}}
    {{#each publishedStories}}
        <div class="profile story" data-story-id="{{_id}}">
          {{> _story_preview_content}}
        </div>
    {{/each}}
  {{else}}
    <div class="message">{{unpublishedMessage}}</div>
  {{/if}}
</template>

<template name="user_favorite_stories">
  <h1>Favorites</h1>
  {{#if hasFavorites}}
    {{#if showAllFavoritesButton}}
      <button class="toggle-favorites">
        See {{#if seeAllFavorites}}fewer{{else}}all{{/if}} favorites
      </button>
    {{/if}}
    {{#each favoriteStories}}
        <div class="profile story" data-story-id="{{_id}}">
          {{> _story_preview_content}}
        </div>
    {{/each}}
  {{else}}
    <div class="message">{{noFavoritesMessage}}</div>
  {{/if}}
</template>


<template name="my_story_profile">
  {{> top_banner}}
  <div class="stories">
    <section>
      <div class="story-container">
        {{> my_stories}}
      </div>
    </section>
  </div>
</template>

<template name="my_stories">
  <div class="published-stories">
    <h1>Published Stories</h1>
    {{#each publishedStories}}
      <div class="story" data-story-id="{{_id}}">
        {{> _story_preview_content}}
        <div class="my-stories-buttons">
          <div class="button-group">
            <button class="unpublish">Unpublish</button>
            <button class="delete">Delete</button>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
  <div class="unpublished-stories">
    {{#if unpublishedStories}}
      <h1>Not Published Yet</h1>
      {{#each unpublishedStories}}
          <div class="story" data-story-id="{{_id}}">
            {{> _story_preview_content useDraftStory=true draftStory=draftStory}}
            <div class="my-stories-buttons">
              <div class="button-group">
                <button class="delete">Delete</button>
              </div>
            </div>
          </div>
      {{/each}}
    {{/if}}
    </div>
</template>
