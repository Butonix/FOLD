<!--
  Templates used in reading, creating, and editing
-->

<template name="story_header">
  {{setTitle title}}
  <div class="title-overlay {{#unless read}}write{{/unless}}" style='background-image: url("{{headerImageUrl}}")'>
    <div id="banner-overlay">
    </div>
    <div class="title-author">
      {{> story_title }}
      <div class="author">By {{authorName}}
      </div>

    </div>
    <div class="logo">
      {{#linkTo route="home"}}
        <img src="/FOLD_LOGO.svg">
      {{/linkTo}}
    </div>

    <div class="attribution {{#unless pastHeader}}shown{{/unless}}">
      Header Image Source: {{headerImageAttribution}}
    </div>
  </div>
</template>

<template name="story_title">
  <div>
    {{{storyTitleDiv}}}
  </div>
</template>

<template name="story">
    <!-- Mesh Background Overlay -->
    <!-- <div id="overlay"></div> -->
    <article class="content">
        <div class="vertical-narrative {{#if narrativeView}}narrativeView{{/if}}"
             style="width: {{cardWidth}}px; left: {{verticalLeft}}px;">
            {{> vertical_narrative}}


          <footer>

          </footer>
        </div>
        {{#unless narrativeView}}
            <div class="horizontal-context" style="{{#unless read}}margin-top: 23px{{/unless}}">
                {{> horizontal_context}}
            </div>
        {{/unless}}
    </article>


    {{#if pastHeader}}
        {{#if read}}
            {{> minimap}}
        {{/if}}
        {{#if horizontalExists}}
            {{#unless addingContext}}
                <div class="browser-offset">
                    {{> story_browser}}
                </div>
            {{/unless}}
        {{/if}}
    {{/if}}
</template>

<template name="vertical_narrative">
  {{#each verticalSectionsWithIndex}}
    {{#unless read}}
      {{> add_vertical_minimized}}
    {{/unless}}
    {{> vertical_section_block}}
  {{/each}}
  {{#unless read}}
    {{> add_vertical_unminimized}}
  {{/unless}}

</template>

<template name="vertical_section_block">
  <div class="narrative-section vertical-narrative-section {{#if verticalSelected}}selected{{/if}} {{#if read}}read{{/if}} {{#if hasTitle}}has-title{{/if}}" data-vertical-index="{{index}}" data-vertical-id="{{_id}}">
    <section>
      {{#unless read}}
        {{#if verticalSelected}}
          <div class="narrative-babyburger-and-menu">
            <button class="narrative-babyburger {{#if babyburgerOpen}}active{{/if}}">
              {{> babyburger_icon}}
            </button>
            {{#if babyburgerOpen}}
              {{> vertical_edit_menu}}
            {{/if}}
          </div>
        {{/if}}
      {{/unless}}
      {{#if hasTitle}}
        {{{titleDiv}}}
      {{/if}}
      {{{contentDiv}}}
      <div class="button">
      </div>
    </section>
  </div>
</template>


<template name="horizontal_context">
  {{#unless read}}
    {{#if verticalExists}}
      {{#if currentYId}}
        {{> add_horizontal}}
      {{/if}}
      {{#each horizontalSections}}
        {{#if horizontalShown}}
          {{> context_anchor_menu}}
        {{/if}}
      {{/each}}
      <div style="display: {{#if addingContext}}inherit{{else}}none{{/if}}">
        {{ > create_horizontal_section_block}}
      </div>
    {{/if}}
  {{/unless}}
  {{#each horizontalSections}}
    {{#if horizontalShown}}
    {{!-- <div class="inline-block {{#unless horizontalShown}}hide{{/unless}}"> --}}
      {{#each data}}
        {{> horizontal_section_block}}
      {{/each}}
      {{#unless read}}
        {{add_horizontal}}
      {{/unless}}
    {{!-- </div> --}}
    {{/if}}

  {{/each}}
</template>


<template name="horizontal_section_block">
  <div
      class="narrative-section horizontal-narrative-section {{#if type}}{{type}}{{/if}} {{#if selected}}selected{{/if}} {{#if editingThisContext}}editing{{/if}}"
      data-index={{index}} style="width: {{cardWidth}}px; left: {{left}}px
  ">
<section>
  <!--    <div id="index">
      {{index}}
    </div> -->
    {{#if type}}
      {{#if text}}
        {{#if editingThisContext}}
          {{> create_text_section}}
        {{else}}
          {{> display_text_section}}
        {{/if}}
      {{/if}}
      {{#if image}}
        {{#if editingThisContext}}
          {{> create_image_section}}
        {{else}}
          {{> display_image_section}}
        {{/if}}
      {{/if}}
      {{#if gif}}
        {{#if editingThisContext}}
          {{> create_gif_section}}
        {{else}}
          {{> display_image_section}}
        {{/if}}
      {{/if}}
      {{#if map}}
        {{#if editingThisContext}}
          {{> create_map_section}}
        {{else}}
          {{> display_map_section}}
        {{/if}}
      {{/if}}
      {{#if audio}}
        {{#if editingThisContext}}
          {{> create_audio_section}}
        {{else}}
          {{> display_audio_section}}
        {{/if}}
      {{/if}}
      {{#if video}}
        {{#if editingThisContext}}
          {{> create_video_section}}
        {{else}}
          {{> display_video_section}}
        {{/if}}
      {{/if}}
      {{#if twitter}}
        {{#if editingThisContext}}
          {{> create_twitter_section}}
        {{else}}
          {{> display_twitter_section}}
        {{/if}}
      {{/if}}
      {{#if viz}}
        {{#if editingThisContext}}
          {{> create_viz_section}}
        {{else}}
          {{> display_viz_section}}
        {{/if}}
      {{/if}}
      {{else}}
        {{> display_broken_section}}
      {{/if}}
      {{#if read}}
        {{> remix_bar}}
      {{/if}}
      </section>
    </div>
  </template>

<template name="remix_bar">
    <div class="remix-bar">
        <!--This card has been shared 6 times-->
        <span class="remix-button">
            {{> remix_icon_square}}
        </span>
    </div>
</template>

<!-- Display Templates -->
<template name="display_text_section">
  <div class="text-section" dir="auto">
      {{content}}
    </div>
    {{#unless read}}
      {{> horizontal_section_edit_delete}}
    {{/unless}}
</template>

<template name="display_image_section">
  <div class="image-section">
    <img src="{{url}}" />
    {{#if description}}
        <div class="description-overlay" dir="auto">
          {{description}}
        </div>
      {{/if}}
  </div>
  {{#unless read}}
    {{> horizontal_section_edit_delete}}
  {{/unless}}
</template>

<template name="display_map_section">
  <div class="map-section">
    {{#if selected}}
      <div class="active-display">
        <iframe width="100%" height="300" frameborder="0" style="border:0" src="{{url}}"></iframe>
      </div>
    {{/if}}
    <div class="preview">
      <img src="{{previewUrl}}"/>
    </div>
  </div>
  {{#unless read}}
    {{> horizontal_section_edit_delete}}
  {{/unless}}
</template>

<template name="display_viz_section">
  <div class="viz-section">
    {{#if selected}}
    <iframe width="100%" height="315" src="{{url}}" frameborder="0" ></iframe>
    {{/if}}
  </div>
  {{#unless read}}
    {{> horizontal_section_edit_delete}}
  {{/unless}}
</template>

<template name="display_audio_section">
  <div class="audio-section">
    {{#if selected}}
      <div class="active-display">
      <iframe width="100%" height="300" frameborder="0" style="border:0" src="{{url}}" allowfullscreen></iframe>
      </div>
    {{/if}}
    <div class="preview">
      <img src="{{previewUrl}}"/>
    </div>
  </div>
  {{#unless read}}
      {{> horizontal_section_edit_delete}}
    {{/unless}}
</template>

<template name="display_video_section">
  <div class="video-section">
    {{#if selected}}
      <div class="active-display">
      <iframe width="100%" height="300" frameborder="0" style="border:0" src="{{url}}" allowfullscreen></iframe>
      </div>
    {{/if}}
    <div class="preview">
      <img src="{{previewUrl}}"/>
    </div>
    {{#if description}}
        <div class="description-overlay" dir="auto">
          {{! description}}
        </div>
      {{/if}}
  </div>
  {{#unless read}}
      {{> horizontal_section_edit_delete}}
    {{/unless}}
</template>

<template name="display_twitter_section">
  <div class="twitter-section">
      <div class="active-display">
      {{#if imgUrl}}
        <div class='image-section'>
          <img src='{{imgUrl}}'>
        </div>
        <button class="show-image"></button>
      {{/if}}
        <div class="twitter-text-section {{#if imgUrl}}image{{/if}}">
          <div class='tweet-card'>
            <div class='title'>
              <div class='prof_pic'>
                <a href="{{user_url}}" target="_blank">
                  <img src="{{userpic}}"> 
                </a>
              </div>
              <div class='username'>
                <div>{{username}} 
                </div>
                <div class="screenname"><a href="{{user_url}}" target="_blank">@{{screenname}}</a>
                </div>
              </div>
            </div>
            <div class="tweet" dir="auto">{{{formattedTweet}}}
            </div>
            <div class="info">
              <span>
                <a href="{{twitter_url}}" target="_blank"><i class="fa fa-twitter"></i>
                </a>
                {{#if retweetUser}}
                  <a href="{{retweet_url}}" target="_blank">
                  <i class="fa fa-retweet"></i>@{{retweetUser}}</a>
                {{/if}}
                <a href="{{tweet_url}}" target="_blank">{{date}}</a>
              </span>
            </div>
            <div class="actions">
              <span>
                <a href="{{reply_action}}" target="_blank">
                  <i class="fa fa-reply"></i>
                </a>
                <a href="{{retweet_action}}" target="_blank">
                  <i class="fa fa-retweet"></i>
                </a>
                <a href="{{favorite_action}}" target="_blank">
                  <i class="fa fa-star"></i>
                </a>
              </span>
            </div>
          </div>
        </div>
      </div>
  </div>
  {{#unless read}}
      {{> horizontal_section_edit_delete}}
    {{/unless}}
</template>


<template name="display_broken_section">
  <div class="broken-section">
  </div>
  {{#unless read}}
    {{> horizontal_section_edit_delete}}
  {{/unless}}
</template>


<template name="story_browser">
  <div class="story-browser">
    <div class="left">
      {{ > browse_arrow_left}}
    </div>
    <div class="right">
      {{ > browse_arrow_right}}
    </div>
  </div>
</template>

<template name="minimap">
  <div class="minimap">
    {{#each horizontalSectionsMap}}
    <div class="section {{#if selectedY}}selected-section{{/if}}">
      <div class="vertical block {{#if selectedY}}selected-block{{/if}}">
      </div>
      {{#each horizontal}}
          <div class="horizontal block {{#if selectedX}}selected-block{{/if}}">
          </div>
      {{/each}}
    </div>
    {{/each}}
  </div>
</template>


<template name="type_specific_icon">
  {{#if twitter}}
    {{ > twitter_icon }}
  {{/if}}
  {{#if video}}
    {{ > video_icon }}
  {{/if}}
  {{#if map}}
    {{ > map_icon }}
  {{/if}}
  {{#if image}}
    {{ > image_icon }}
  {{/if}}
  {{#if viz}}
    {{ > viz_icon }}
  {{/if}}
  {{#if gif}}
    {{ > gif_icon }}
  {{/if}}
  {{#if audio}}
    {{ > audio_icon }}
  {{/if}}
  {{#if text}}
    {{ > text_icon }}
  {{/if}}
  {{#if remix}}
    {{ > remix_icon }}
  {{/if}}
</template>

<template name="favorite_button">
    <div class="favorite-button">
        {{#if userFavorited}}
            <button type='button' class='unfavorite'>{{> favorite_icon }}</button>
        {{else}}
            <button type='button' class='favorite'>{{> favorite_icon }}</button>
        {{/if}}
        {{favorited.length}}
    </div>
</template>

<template name="stats">
  {{> serverFacts}}
</template>
